# 第七章

本章知识点叫凌乱，无法系统总结，故此处只记录一些个人认为的重点。

## 1、静态链接

静态链接器以一组可重定位目标文件和命令行参数作为输入，生成一个完全链接的、可以加载运行的可执行目标文件作为输出。

### 可重定位目标文件

一个典型的 ELF 可重定位文件格式如下，ELF 头以一个 16 字节的序列开始，这个序列描述了生成该文件的系统的字和大小的顺序等信息，夹在 ELF 头和节头部表之间的都是节。

![image](https://user-images.githubusercontent.com/56211928/146772788-4d100a3d-be58-483f-8196-4a2c748c11f7.png)

夹再 ELF 头和节头部表之间的都是节。一个典型的 ELF 可重定位目标文件包含下面几个节：

- .text：已编译程序的机器代码
- .radata：只读数据，如 printf 语句中的格式串和开关语句的跳转表。
- .data: 已初始化的全局和静态变量。局部变量在运行时被保存在栈中，既不出现在 .data 节中，也不出现在 .bss 节中。
- .bss: 未初始化的静态 C 变量，以及所有被初始化为 0 的全局或静态变量。在目标文件中，未初始化变量不需要占据任何实际的磁盘空间。运行时，在内存中分配这些变量，初始值为 0。
- .syrntab: 一个符号表，它存放在程序中定义和引用的函数和全局变量的信息。.syrntab 符号表不包含局部变量的条目。
- .rel.text: 一个 .text 节中位置的列表，当链接器把这个目标文件和其他文件组合时，需要修改这些位置。一般而言，任何调用外部函数或者引用全局变量的指令都需要修改。另一方面，调用本地函数的指令则不需要修改。
- .rel.data: 被模块引用或定义的所有全局变最的重定位信息。一般而言，任何已初始化的全局变量，如果它的初始值是一个全局变量地址或者外部定义函数的地址，都需要被修改。
- .debug: 一个调试符号表，其条目是程序中定义的局部变量和类型定义，程序中定义和引用的全局变量，以及原始的 C 源文件。只有以 -g 选项调用编译器驱动程序时，才会得到这张表。
- .line: 原始 C 源程序中的行号和 .text 节中机器指令之间的映射。只有以 -g 选项调用编译器驱动程序时，才会得到这张表。
- .strtab: 一个字符串表，其内容包括 .symtab 和 .debug 节中的符号表，以及节头部中的节名字。字符串表就是以 null 结尾的字符串的序列。
