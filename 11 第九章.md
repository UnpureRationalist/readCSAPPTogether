# 第九章

## 虚拟内存

虚拟内存是硬件异常、硬件地址翻译、主存、磁盘文件和内核软件的完美交互，它为每个进程提供了一个大的、 一致的和私有的地址空间。虚拟内存提供了三个重要的能力： 

- 它将主存看成是一个存储在磁盘上的地址空间的高速缓存，在主存中只保存活动区域，并根据需要在磁盘和主存之间来回传送数据。
- 它为每个进程提供了一致的地址空间，从而简化了内存管理。
- 它保护了每个进程的地址空间不被其他进程破坏。

虚拟内存是一个实际上不存在的内存系统，它的每个内存页实际上是到物理内存或磁盘的映射。在任意时刻，虚拟页面的集合都分为三个不相交的子集：

### 页表

操作系统为每个进程提供一个独立的页表，页表将虚拟页映射到物理页，虚拟地址空间中的每个页在页表中一个固定偏移量处有一个页表条目（PTE）。我们假设每个 PTE 由一个地址有效位和一个 n 位地址字段组成，有效位表明该虚拟页当前是否缓存在 DRAM 中，根据有效位和地址字段的不同，可以将 PTE 分为以下三类：

- 有效位为 0，地址字段为空：虚拟系统还未分配的页，它不会占据任何内存或磁盘的空间。
- 有效位为 0，地址字段不空：未缓存在物理内存中的已分配页，目前存放在磁盘上。
- 有效位为 1：当前以缓存在物理内存中的已分配页。

![image](https://user-images.githubusercontent.com/56211928/147178169-21d50c4e-d522-4bf8-bdab-0a7d5ec8db62.png)


## 内存映射

## 动态分配内存
